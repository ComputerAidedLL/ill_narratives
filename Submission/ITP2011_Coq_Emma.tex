\documentclass[runningheads,a4paper]{llncs}
\usepackage{marginote}%A enlever avant envoi
\usepackage{textcomp}
\usepackage{amsmath}
\usepackage{amssymb}
\newcommand{\N}{\mathbb{N}}

\setcounter{tocdepth}{3}
\usepackage{graphicx}
\usepackage{bnf}
\usepackage{bussproofs}
\usepackage{multirow}

\usepackage{url}
%\urldef{\mailsa}\path|{alfred.hofmann, ursula.barth, ingrid.haas, frank.holzwarth,|
%\urldef{\mailsb}\path|anna.kramer, leonie.kunz, christine.reiss, nicole.sator,|
%\urldef{\mailsc}\path|erika.siebert-cole, peter.strasser, lncs}@springer.com|    
\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

\usepackage{listings}
\usepackage{bold-extra}
\usepackage{lstcoq}
\lstset{language=Coq,fontadjust=false,columns=fixed,showspaces=false,showstringspaces=false}
\lstset{basicstyle=\tt\small,commentstyle=\it\ttfamily,basewidth={0.475em},keywordstyle=\bf\ttfamily}
\lstset{captionpos=t,float,belowskip=\smallskipamount,aboveskip=\smallskipamount}

\newcommand{\seq}[2]{$#1\:\vdash\:#2$}
\newcommand{\plab}[1]{\RightLabel{($#1$)}}
\newcommand{\uinf}[1]{\UnaryInfC{#1}}
\newcommand{\binf}[1]{\BinaryInfC{#1}}
\DeclareMathOperator{\wf}{WF}


\begin{document}

\mainmatter  % start of an individual contribution

\title{Structural Analysis of Narratives with the Coq Proof Assistant}

% a short form should be given in case it is too long for the running head
\titlerunning{Structural Analysis of Narratives with the Coq Proof Assistant}
% the name(s) of the author(s) follow(s) next
%
% NB: Chinese authors should write their first names(s) in front of
% their surnames. This ensures that the names appear correctly in
% the running heads and the author index.
%
\author{Anne-Gwenn Bosser\inst{1}%
%\thanks{Please note that the LNCS Editorial assumes that all authors have used
%the western naming convention, with given names preceding surnames. This determines
%the structure of the names in the running heads and the author index.}%
\and Pierre Courtieu\inst{2}\and Julien Forest\inst{2} \and Marc Cavazza\inst{1}}
%
%\authorrunning{Lecture Notes in Computer Science: Authors' Instructions}
% (feature abused for this document to repeat the title also on left hand pages)

% the affiliations are given next; don't give your e-mail address
% unless you accept that it will be published
\institute{University of Teesside, School of Computing, Intelligent Virtual Environments Research Group\\
\url{http://ive.scm.tees.ac.uk/}
\and
Conservatoire National des Arts et M\'{e}tiers, Laboratoire CEDRIC, Equipe CPR\\
\url{http://cedric.cnam.fr/}}

%
% NB: a more complex sample for affiliations and the mapping to the
% corresponding authors can be found in the file "llncs.dem"
% (search for the string "\mainmatter" where a contribution starts).
% "llncs.dem" accompanies the document class "llncs.cls".
%

%\toctitle{Lecture Notes in Computer Science}
%\tocauthor{Authors' Instructions}
\maketitle
\begin{abstract}
This paper proposes a novel application of Interactive Proof Assistants for studying the formal properties of Narratives, building on recent work demonstrating the suitability of Intuitionistic Linear Logic as a conceptual model. 
More specifically, we describe a method for modelling narrative resources and actions, together with constraints on the story endings in the form of an ILL sequent. We describe how well-formed narratives can be interpreted from cut-free proof trees of the sequent obtained using Coq. We finally describe how to reason about narratives at the structural level using Coq: by allowing to prove 2nd order properties on the set of all the proofs generated by a sequent, Coq assists the verification of structural narrative properties traversing all possible variants of a given plot.
\keywords{Applications of Theorem Provers, Linear Logic, Formal Models of Narratives}
\end{abstract}


\section{Introduction}
%
Narrative representations have always played a prominent role in AI research and Cognitive Science (see~\cite{Richards09} for a recent review and current trends, and~\cite{AAAI10}). More recently, the emergence of new media has created an opportunity for real-world applications of computational models of narratives~\cite{Laurel93,Murray98}. Research in Interactive Storytelling, whose long-term goal is to create narratives which can respond and adapt in real-time to user's reaction, has thus recently become a sustained interest within the AI community~\cite{AAAI07,AAAI09}.

Recent research in Interactive Storytelling has converged on the use of AI techniques (mostly Planning~\cite{Young99}) to generate consistent plots (seen as a sequence of actions corresponding to the backbone of the narrative), but has paradoxically failed to capitalise on narrative representations. Initial hopes of developing computational narratology on the same basis as computational linguistics using narrative models developed in the field of humanities~\cite{Greimas66,Bremond73} have been dashed by the finding that they were closer to ontologies than to proper logical or computational formalisms~\cite{Cavazza06}.

In order to overcome this dead-end, we have recently described in~\cite{bosser10} how Linear Logic(LL)~\cite{GirardTCS87}, and in particular Intuitionistic Linear Logic~\cite{GirardILL87} can provide a suitable conceptual model for Narratives on a structural basis. Interactive Narratives are modelled as proofs of a sequent written in Linear Logic which describes initial resources and possible narrative actions. This allows to express naturally key properties for Interactive Narratives while suporting a return to first principles of narrative action representation (causality and competition for resources).

%a affiner/preciser. ce paragraphe doit etre accrocheur pour la communaute.
Building on this work, we propose here a first step towards the automation of the structural analysis of interactive narratives using the Coq Proof-Assistant. We describe how to specify narratives on a structural basis only in the form of an ILL sequent, and a dedicated ILL encoding into Coq, with tactics allowing to obtain proofs of such a sequent. We describe how such proofs are interpreted as well-formed narratives. Our encoding of ILL into Coq supports, as have previous work, the assisted generation of ILL proofs, but also assists the reasoning on the properties of proofs and on all the possible proofs of an ILL sequent. This allows us to explore second order structural properties traversing all the interactive narratives which can be generated from a description of initial and atomic narrative actions and resources.

%Further work: tactics based on patterns of use.
\section{Related Works}
%\subsection{Logical Approaches to Interactive Storytelling}
%inclure travaux avec LL.\\
%meme approche que pour papier ECAI mais en insistant plus sur usages de LL + model checking via petri nets/colored petri nets.\\
%LL tool support for IS: model checking w. petri nets. Montrer la difference de l'approche auto/prouveur avec une approche Proof Assistant. Insister sur le fait que meme si ils semblent inclure tous les connecteurs on voit pas bien comment ils s'en sortent pour l'indecidabilite, et que le fragment de LL utilise est vraiment pas clair du tout.
%\subsection{Related applications of Linear Logic}
%computational linguistics: a ete utilise pour la representation d'actions. Ici on etend a un context d'action narratives.\\
%LL and planning: idem, representation d'actions.\\
%Referer a ECAI-LL-Emma comme "evidence" que LL presente une theorie de l'action particulierement adaptee a la narration interactive.
%\subsection{Proof Assistants and Automatic Provers support for LL}
%Encodings existants (plusieurs naifs, certains sans proof-terms (juste oui/non) ce qui ne convient pas, c'est la preuve qui nous interesse pas le fait que ce soit prouvable seulement.Les proches:Dixon Isabelle, LLP. 

%Dixon: usage "proche" car pour de la planif + le seul exemple d'encodage d'ILL avec des tactiques un peu elaborees dans un assistant de preuve. Nous, on a pas de tactiques definies, mais cet exemple montre que c'est possible et qu'il y a tout un champ qui a ete tres peu investigue par la recherche, et qui a un gros potentiel d'automatisation/semi-automatisation. Les approches Prouveur automatique  a la LLProver (qui mouline 3 semaines sans que rien ne sorte...) et Petri nets ne permettent pas en l'etat actuel des connaissances de passer au niveau du fragment ILL qui est suffisament expressif. L'approche Assistant de Preuve semi-automatique est une premiere etape, permettant d'etudier dans le futur des tactiques performantes, sans avoir a restreindre l'expressivite du fragment considere. Ces consideration sont pour des travaux futurs sur une automatisation ou automatisation partielle.

%\subsection{Proposed Approach}
%Pour notre sujet, l'analyse de proprietes de narration interactives, et de specification de narration interactives, avantage qu'il y a a pouvoir faire des preuves au second ordre grace a une approche proof-assistant, comparee a une approche prouveur automatique: Meme sans automatisation, un assistant de preuve permet d'exprimer des proprietes "arbitraires" au second ordre sur une specification de narrations interactives: de raisonner sur un ensemble d'histoires que peut generer la specification. Ceci permet de verifier ces proprietes (qui sont structurelles, et suivant notre analogie, mappee sur la structure de la preuve). C'est ce qu'on discute dans ce papier.
\section{ILL as a Representational Theory for IS}
%
Our approach is based on a formal specification of interactive narratives resources (including narrative actions), initial conditions, and possible ending states in the form of an ILL sequent. We then interpret a given proof of such a sequent as an interactive narrative. A sequent may have multiple proofs. It may therefore specify multiple interactive narratives sharing the same initial resources and narrative actions. When interpreting the proof as an interactive narrative, we look for a trace of the use of the $\multimap$ left rule. This rule is interpreted as the execution of a narrative action. Other rules have an interpretation reflecting the structure of the interactive narrative, such as an external branching choice in an open-world assumption (for instance, end-user interaction), or a concurrency relationship between different subsets of the narrative with independant resource requirements. 
%The story event corresponding to the exection of the $A_{1}\oplus A_{2}$ left rule enforces that both sub-proofs describe the consumption of resources in the rest of the context with each formulae $A_{i}$ leads to the production of the right-hand side formula. It does correspond in out interpretation to ensuring that each of these possibilities in the interactive narrative is a well-formed story.
\subsection{Modelling of Interactive narratives specification through an ILL sequent\label{subsec:narrative_to_sequent}}
% description de la modelisation du sequent
%The choice of linear logic for representing interactive narratives was originally motivated by the need to capture the nature of narrative actions, and in particular their causal properties. Indeed, the description of narrative causality requires being able to express the semantic of narrative actions, which is modelled very precisely thanks to the explicit management of resources allowed by Linear Logic~\cite{Bosser10}. Using Linear Logic for Knowledge Representation for action semantics also allows to elegantly avoid the frame problem presented by other AI formalism such as the situation calculus. 
%
The subset language of ILL we define here allows to describe the initial resources of the narrative, the available narrative actions, and constraints on the possible ending states of the narrative. Key to our interpretation, narrative actions are modelled using $\multimap$ which allows a precise description of their impact on the narrative environment. As we work in an open world assumption, external impact on the narrative (for instance user interaction) is modelled by using the $\oplus$ connector for describing choices between possible narrative actions, and by using $\&$ for describing a choice between two possible ending states.

Such a specification of narratives encompasses the description of the available resources and states of the narratives, the description of the semantic of narrative actions through their impact on the context of execution, and the possible ending states of the narrative. The initial sequent thus takes the form $\Gamma , \Delta \vdash \mathtt{Goal}$, where $\Gamma$ is a multiset representing resources and initial conditions, $\Delta$ is a multiset representing the possible narrative actions, and $Goal$ a formula representing the possible ending state of the narrative. A sequent thus provides the knowledge representation base of a set of narratives. 

While the description of the sequent places us in the whole ILL fragment, the modeling language we use for this paper causes restrictions on the structure of formulae. This will in turn enforce properties of the generated proofs can be verified using Coq.

Figure~\ref{fig:sequent_grammars} describes the modelling of interactive narratives specifications into an ILL sequent.
%
\subsubsection{Resources of an Interactive Narrative}
Part of the left-hand side of the sequent consists in the description of the available resources and initial states. A resource can be an atom, 1, or composed. The formula $\mathtt{Res_{1}}\&\mathtt{Res_{2}}$, expresses the availability of one of the resources. One only of $\mathtt{Res_{i}}$ will be used and the choice depends on the proof search, and can vary depending on the branches of the proof. This allows us to describe how the initial conditions can adapt to a given unfolding of the story. The formula $\mathtt{Res_{1}} \otimes \mathtt{Res_{2}}$ allows to express the availability of both resources. The formula $!\mathtt{Res}$ allows to express the unbounded availability of the resource $\mathtt{Res}$.
\begin{figure}
\begin{grammar}
      [(colon){::=}]
      [(semicolon)$|$]
      [(comma){}]
      [(period){\\}]
      [(quote){\begin{tt}}{\end{tt}}]
      [(nonterminal){$\langle$}{$\rangle$}]
"Res":1;"atom";"Res",$\&$,"Res";"Res",$\otimes$,"Res";!"Res".
"Act":1;"CRes",$\multimap$,"Context";"Act",$\oplus$,"Act";"Act",$\&$,"Act";!,"Act".
"Goal":1;"atom";"Goal",$\otimes$,"Goal";"Goal",$\oplus$,"Goal";"Goal",$\&$,"Goal".\\
"CRes":1;"atom";"CRes",$\otimes$,"CRes".
"Context":"Res";"Act";"Context",$\otimes$,"Context".
\end{grammar}
\caption{Resources ($\mathtt{Res}\in\Gamma$), Actions ($\mathtt{Act}\in\Delta$) and Goal description for the $\Gamma, \Delta \vdash \mathtt{Goal}$ sequent specifying a narrative. Actions consume resources of the form \texttt{RCons} and produce context formulae of the form \texttt{Context}\label{fig:sequent_grammars}}
\end{figure}
%
\subsubsection{Narrative Actions Representation}
A simple narrative action is of the form $\mathtt{CRes} \multimap \mathtt{Context}$, where \texttt{Cres} is a finite resource description and \texttt{Context} a multiplicative conjunction of resources and actions. Its semantic is thus precisely defined in terms of how it affects the execution environment: to the execution of a narrative action in the narrative corresponds the application of the $\multimap$ left rule in the proof, consuming the resources modelled by \texttt{CRes} and introducing in the sequent context the formula \texttt{Context} which models resources and actions made available by this execution.

Narrative actions can be composed for offering two types of choices. A composed action $\mathtt{Act_{1}} \oplus \mathtt{Act_{2}}$ corresponds to a choice between two possible actions, with both possibilities leading to well-formed alternative narratives. This is used for modelling the impact of events external to the narrative in an open-world assumption (for instance, user interaction). When such a formula is decomposed using the $\oplus$ rule, the two sub-proofs, which require proving the sequent with each of the subformula replacing the composed action, are interpreted as the two possible unfolding of the story. The proof thus ensures that each possible subsequent narrative is well-formed. A composed action $\mathtt{Act_{1}} \& \mathtt{Act_{2}}$ corresponds to a choice depending on the proof-search, and might differ depending on the branch of the proof. If both choices successfully produce a different proof of the sequent, this will be interpreted as two different interactive narratives.
\subsubsection{Narrative ending states}
The resulting state of a narrative is modelled in the subset of ILL composed of $\otimes$ and $\oplus$ and $\&$. 
$\mathtt{Goal_{1}} \otimes \mathtt{Goal_{2}}$ expresses that both $Goal_{i}$ states are accessible at the end of the interactive narrative. $\mathtt{Goal_{1}} \oplus \mathtt{Goal_{2}}$ expresses that either state $\mathtt{Goal_{i}}$ is accessible, and the choice depends on the proof search and might differ depending on the unfolding branch of the narrative.$\mathtt{Goal_{1}} \& \mathtt{Goal_{2}}$ expresses that either state should be accessible, and this choice depends on an event external to the narrative, such as user interaction for instance. Similarly to the situation with composed actions $\mathtt{Act_1}\oplus\mathtt{Act_2}$, the sub-proofs following the application of the $\&$ right rule will allow ensuring that the corresponding narratives are well-formed stories.
%Note: we don't need $\multimap (R)$, $! (R)$ as the sequent language is stable: these connectors can't appear on the right side whatever the sequent appearing in the proof, see after.
%
\subsubsection{Stability of the representation}
%
Given an ILL sequent respecting the grammar described on figure~\ref{fig:sequent_grammars}, all the sequent appearing in the proof will be of the form $\Gamma\vdash G $, where $\forall F\in\Gamma$, $F$ is a \texttt{Context} formula and $G$ is a \texttt{Goal} formula. In other words, modulo the application of the $\otimes$ left rule, all the sequents apearing in such a proof will be composed of a context describing resources and actions of a narrative, and of a right-hand side formula representing constraints on the ending state of the narrative.

More formally, we define the following properties on sequents and
proofs:
\begin{definition}
  Let $s$ be a sequent of the form $\Gamma\vdash G$, we say that $s$
  is \emph{well formed} if $G\in\texttt{Goal}$ and $\forall
  F\in\Gamma, f \in \texttt{Context}$. We shall write $\wf(s)$.
\end{definition}
\begin{definition}
  A property $P$ on sequents is said to \emph{hold for a proof} $h$ of
  a sequent $s$ if it holds for all sequents of the proof $h$ above
  $s$. We shall note $\wf(h)$.
\end{definition}
\begin{definition}\label{def:stab}
  $\wf$ is stable for ILL, that is for any sequent $s$ such that
  $\wf(s)$ and any proof $h$ of $s$, $\wf(h)$.
\end{definition}
The proof of this property in Coq is described later in section~\ref{sec:second-order-analys}.
%
\subsection{Interpreting a proof as an Interactive narrative\label{subsec:proof_to_narrative}}
Interactive narratives are interpreted from proofs, from a structured trace of execution of the $\multimap$ left rule. Other ILL rules of particular significance for this interpretation are the $\oplus$ left, and $\otimes$ and $\&$ right rules. Interactive narratives are obtained from proofs using the $\nu$ function described on figure~\ref{fig:interpretation}. The obtained narratives are thus described using simple narrative actions (modelled in the initial sequent using the $\multimap$ connector), and the following list of operators:
\begin{itemize}
\item [$\succ$] is a precedence relationship, defining a partial order on the execution of narrative actions: $\nu=\nu_1\succ \nu_{action} \succ \nu_2$ is a narrative where the narrative $\nu_1$ precedes the narrative action $\nu_{action}$ which precedes the narrative $\nu_2$.
\item [$\triangledown$] is a branching of the narrative in an open-world assumption: $\nu=\nu_1\triangledown\nu_2$ is a narrative where both sub-narratives $\nu_1$ and $\nu_2$ are possible, but only one will actually be unfolded, depending on an external event in an open-world assumption (such as user interaction for instance).
\item [$\|$] represents a concurrency relationship between two narratives: $\nu=\nu_1\|\nu_2$ is a narrative consisting of both $\nu_1$ and $\nu_2$ where the two sub-narratives will be unfolded concurrently and independently.
\end{itemize}
\begin{figure}
%\begin{minipage}{0.5\columnwidth}
%\begin{prooftree}
%\AxiomC{\seq{\Gamma}{A}}
%    \AxiomC{\seq{\Delta , B}{C}}
%    \plab{\multimap_{left}}
%\binf{\seq{\Gamma , \Delta , A \multimap B}{C}}
%\end{prooftree}
%\end{minipage}
%
%\begin{minipage}{0.5\columnwidth}
%\center
%\begin{prooftree}
%\AxiomC{\seq{\Gamma , A}{C}}
%    \AxiomC{\seq{\Gamma , B}{C}}
%\plab{\oplus_{left}}
%\binf{\seq{\Gamma , A \oplus B}{C}}
%\end{prooftree}
%\end{minipage}
%
%\begin{minipage}{0.5\columnwidth}
%\center
%\begin{prooftree}
%\AxiomC{\seq{\Gamma}{A}}
%    \AxiomC{\seq{\Gamma}{B}}
%\plab{\&_{right}}
%\binf{\seq{\Gamma}{A\& B}}
%\end{prooftree}
%\end{minipage}
%
%\begin{minipage}{0.5\columnwidth}
%\begin{prooftree}
%\AxiomC{\seq{\Gamma}{A}}
%    \AxiomC{\seq{\Delta}{B}}
%\plab{\otimes_{right}}
%\binf{\seq{\Gamma , \Delta}{A \otimes B}}
%\end{prooftree}
%\end{minipage}
%
%\begin{center}
%\begin{tabular}{r l}
% $\nu(l)$                                              & $= \emptyset$\\
% $\nu(unary[P])$                                           & $ = \nu(P)$\\
% $\nu(\multimap_{left}[P_{left};P_{right}](A\multimap B))$ & $= \nu(P_{left}) \succ \nu(A \multimap B) \succ(P_{right})$\\
% $\nu(\oplus_{left}[P_{left};P_{right}])$                   & $= \nu(P_{left}) \triangledown \nu(P_{right})$\\
% $\nu(\&_{right}[P_{left};P_{right}])$                       & $= \nu(P_{left}) \triangledown \nu(P_{right})$\\
% $\nu(\otimes_{right}[P_{left};P_{right}]$                   & $= \nu(P_{left}) \| \nu(P_{right})$
%\end{tabular}
%\end{center}
\begin{minipage}{0.5\columnwidth}
\begin{prooftree}
\AxiomC{\seq{\Gamma}{A} : $\nu_1$}
    \AxiomC{\seq{\Delta , B}{C} : $\nu_2$}
    \plab{\multimap_{left}}
\binf{\seq{\Gamma , \Delta , A \multimap B}{C} : $\nu_1 \succ \nu_{A\multimap B} \succ \nu_2$}
\end{prooftree}
\end{minipage}
%
\begin{minipage}{0.5\columnwidth}
\begin{prooftree}
\AxiomC{}
\plab{Leaf\: rule}
\uinf{\seq{\Gamma}{A} : $\emptyset$}
\end{prooftree}
\end{minipage}
%
\begin{minipage}{0.5\columnwidth}
\begin{prooftree}
\AxiomC{\seq{\Gamma}{A} : $\nu_1$}
    \AxiomC{\seq{\Delta}{B} : $\nu_2$}
\plab{\otimes_{right}}
\binf{\seq{\Gamma , \Delta}{A \otimes B} : $\nu_1 \| \nu_2$}
\end{prooftree}
\end{minipage}
%
\begin{minipage}{0.5\columnwidth}
\begin{prooftree}
\AxiomC{\seq{\Gamma}{A} : $\nu$}
\plab{Unary\: rule}
\uinf{\seq{\Gamma'}{A'} : $\nu$}
\end{prooftree}
\end{minipage}
%
\begin{minipage}{0.5\columnwidth}
\center
\begin{prooftree}
\AxiomC{\seq{\Gamma , A}{C} : $\nu_1$}
    \AxiomC{\seq{\Gamma , B}{C} : $\nu_2$}
\plab{\oplus_{left}}
\binf{\seq{\Gamma , A \oplus B}{C} : $\nu_1 \triangledown \nu_2$}
\end{prooftree}
\end{minipage}
%
\begin{minipage}{0.5\columnwidth}
\center
\begin{prooftree}
\AxiomC{\seq{\Gamma}{A} : $\nu_1$}
    \AxiomC{\seq{\Gamma}{B} : $\nu_2$}
\plab{\&_{right}}
\binf{\seq{\Gamma}{A\& B} : $\nu_1 \triangledown \nu_2$}
\end{prooftree}
\end{minipage}
%
\caption{Proof to Narrative Interpretation Function $\nu$: the function is defined recursively on sub-proofs from the last applied rule. $\nu_{A\multimap B}$ is the narrative action initially specified using the formula $A\multimap B$ \label{fig:interpretation}}
\end{figure}
\subsection{From narrative specification to narrative: an example}
We can now illustrate our approach through a complete example of narrative generation based on a specification of initial narrative resources and actions. This process is described on Figure~\ref{fig:example}. We use an extract of Flaubert's classical Madame Bovary novel. 
\begin{figure}
\begin{enumerate}
\item Narrative Resources and Actions:

\vspace{0.1in}
\begin{tabular} {|l|l|}
\hline
\multicolumn{2}{|c|}{Atomic resources}\\ \hline
P      & Poison\\
R      & A discussion with Rodolphe\\
B      & A discussion with Binet\\
G      & A discussion with Guillaumin\\
\hline
\end{tabular}
\begin{tabular}{|l|l|}
\hline
\multicolumn{2}{|c|}{Atomic goals}\\ \hline
A     & Emma is alive\\
M     & Emma is dead\\
\hline
\end{tabular}

\vspace{0.1in}
\begin{tabular}{|p{0.08\columnwidth}|p{0.92\columnwidth}|}
\hline
\multicolumn{2}{|c|}{Simple Narrative Actions}\\ \hline
S$\multimap$A & Emma sells herself which saves her life\\
E$\multimap$A & Emma escapes with Rodolphe which saves her life\\
P$\multimap$M & Emma takes poison and dies\\ 
R$\multimap$1 & Emma discusses with Rodolphe. This leads to nothing new.\\
R$\multimap$E & Emma discusses with Rodolphe. It leads to the agreement to escape together.\\
G$\multimap$1 & Emma discusses with Guillaumin. This leads to nothing new.\\
G$\multimap$S & Emma discusses with Guillaumin. It leads to the agreement that Emma would sell herself in exchange for Guillaumin's help.\\
B$\multimap$1 & Emma discusses with Binet. This leads to nothing new.\\
B$\multimap$S & Emma discusses with Binet. It leads to the agreement that Emma would sell herself in exchange for Binet's help.\\
\hline
\end{tabular}

\vspace{0.1in}
\item Sequent Description\\
\begin{tabular} {|l|| l|}%{p{0.24\columnwidth} p{0.76\columnwidth}}%{|p{0.2\columnwidth |p{0.8\columnwidth}|}
\hline
Initial Resources $\mathcal{R}$ &  $P \& 1, R, G, B\& 1$\\ \hline
\multirow{2}{*}{Narrative actions $\mathcal{A}$} & $!(S \multimap A), (E \multimap A) \& 1, (P \multimap M) \& 1,(R \multimap 1)\&(R \multimap E),$\\
 & $(G \multimap 1) \oplus (G \multimap S), 1 \oplus ((B \multimap S)\&(B \multimap 1))$\\ \hline
\end{tabular}
%\end{minipage}

\item Sketch of the proof:\\
\begin{prooftree}
\AxiomC{$\multimap_{left}: P\multimap M $}
\uinf{$\multimap_{left}: R\multimap 1 $}
\uinf{$\multimap_{left}: B\multimap 1 $}
    \AxiomC{$\multimap_{left}: E\multimap A $}
    \uinf{$\multimap_{left}: R\multimap E $}
\binf{$\oplus{left}: 1 \oplus ((B \multimap S)\&(B \multimap 1))$}
\uinf{$\multimap_{left}: G\multimap 1 $}
	\AxiomC{$\multimap_{left}: S\multimap A $}
		\AxiomC{$\multimap_{left}: S\multimap A $}
		\uinf{$\multimap_{left}: B\multimap 1 $}
	\binf{$\oplus{left}: 1 \oplus ((B \multimap S)\&(B \multimap 1))$}
	\uinf{$\multimap_{left}: R\multimap 1 $}
	\uinf{$\multimap_{left}: G\multimap S $}    
\binf{$\oplus_{left} :(G \multimap 1) \oplus (G \multimap S)$}
\uinf{$\mathcal{R},\mathcal{A}  \vdash A \oplus M$}
\end{prooftree}

\item Interpreted narrative:\\
$(\nu_{G\multimap 1}\succ((\nu_{B \multimap 1} \succ \nu_{R \multimap 1} \succ \nu_{P \multimap M}) \triangledown ( \nu_{R \multimap E} \succ \nu_{E\multimap A}))) \triangledown$\\
$ (\nu_{G\multimap S} \succ \nu_{R\multimap 1} \succ (\nu_{S\multimap A} \triangledown (\nu_{B\multimap 1} \succ \nu_{\multimap A}))$
\end{enumerate}
\caption{Example of the specification of a narrative environment into an ILL sequent, a corresponding proof obtained with Coq, and the corresponding interpreted narrative: The end of Emma Bovary\label{fig:example}}
\end{figure}
%
We start from an identification of atomic resources and simple narrative actions: we add alternatives to some of the narrative actions occuring in the novel, inspired by each of the character's possible choice. Based on this identification, we model a narrative context and goals as an ILL sequent. Composed actions and resources are defined, in order to reflect branching narrative possibilities depending on the impact of external events in an open-world assumption (for instance, the composed action $(G\multimap 1) \oplus (G \multimap S)$), in order to allow for the generation of different courses of actions (for instance, the action $(E\multimap A) \& 1$ can potentially generate a narrative where the narrative action corresponding to $E\multimap A$ occurs or not), and so on. 

Once the sequent has been specified, we use Coq with simple tactics to generate a proof (sketched on Figure~\ref{fig:example}). The proof can then be interpreted as a given narrative.

The rest of the paper describes how we have taken advantadge of Coq's features to develop simple tactics allowing to generate well-formed stories, but also, more importantly, the opportunities offered in terms of narrative structural analysis by the possibility to consider the proofs as first class objects.

In particular, we demonstrate certain properties on the proofs that our subset specification language generates, opening future perspectives regarding the normalisation of narratives.

We also illustrate how, by allowing to express properties regarding the set of all possible proofs of a given sequent, Coq can be used to formally evidence structural properties which are verified by all the narratives generated by a given specification.
%
\section{Using the Coq proof assistant for Story Properties Analysis}
\subsection{ILL encoding into Coq}
\label{sec:ill-encoding-into}
%
A lot of encodings of (different fragments and variants of) linear
logic have been proposed in proof assistants. In~\cite{Power99} for
instance, authors present a shallow embedding of ILL in Coq and
perform some simple generic proofs using induction.
In~\cite{Sadrzadeh03modallinear} authors present a shallow embedding
of the sequent calculus of classical modal linear logic and performs
some \emph{epistemic} proofs. In~\cite{Kalvala95mechanizinglinear} an
efficient and easy to use implementation of ILL rules in the Isabelle
framework is presented.\marginote{Quid de l'implementation de Dixon pour planning en Isabelle (quelques tactiques decrites) dans~\cite{Dixon09b} plus chopper son etat de l'art.}

In many aspects our modeling of ILL in Coq is similar to these work.
The main original feature of this development is the focus on
properties of \emph{proofs} themselves, not only on provability of
sequents. As in these previous works we provide some (limited)
automation for proving \emph{closed sequents}
(section~\ref{sec:proving-an-ill}), but we also provide reasoning
lemmas and tactics for reasoning on properties of proofs and even on
\emph{all possible proofs of a sequent}\marginote{reprendre selon resultats obtenus}
(section~\ref{sec:second-order-analys}). The relation between the
shape of a proof and the properties of the corresponding interactive
narrative is to our knoledge an original use of the proof-as-term
paradigm.

Formulae, proofs and corresponding convenient (Unicode) notations are
defined as follows. Type \texttt{env} is an instance of multisets
equipped with an equivalence relation \texttt{==} and Vars.t (type of
atomic propositions) is implemented\footnote{by functorial
  application} as $\N$ in the following:

\begin{lstlisting}
Inductive formula : Type := 
| Proposition : Vars.t -> formula | Implies : formula -> formula -> formula 
| Otimes : formula -> formula -> formula | One : formula 
| Oplus : formula -> formula -> formula | Zero : formula | Top : formula
| Bang : formula -> formula | And : formula -> formula  -> formula.

Notation "A -o B" := (Implies A B).
(* ...Other connectives... *) (*@ % Notation  "A ++ B" := (Oplus A B).
  % Notation  "A ** B" := (Otimes A B).
  % Notation "1" := One.
  % Notation "0" := Zero.
  % Notation  "! A" := (Bang A).
  % Notation  "A & B" := (And A B).
  % Notation  "\Top" := Top.
  % Notation  "x \in \G" := (mem x G = true).
@*)
Notation  "x :: \G" := (add x G). (* Environment operation *)
Notation  "x \ \G" := (remove x G). (* Environment operation *)
 
Inductive ILL_proof: env -> formula -> Prop:=
|Id: forall \G p, \G == {p} -> \G |- p
|Impl_R: forall \G p q, p::\G |- q -> \G |- p-oq
|Impl_L: forall\G\D\Epqr,(p-oq)\in\G -> (\G\(p-oq))==\D\U\E -> \D|-p -> q:: \E|-r -> \G |- r
|Times_R: forall \G \D \D' p q, \G == \D\U\D' -> \D |- p -> \D' |- q -> \G |- p ** q
|Times_L: forall \G p q r, (p ** q)\in\G -> q::p::(\G\(p ** q)) |- r -> \G |- r
|One_R: forall \G, \G == \O -> \G |- 1
|One_L: forall \G p, 1\in\G -> (\G\1) |- p -> \G |- p
|And_R: forall \G p q, \G |- p -> \G |- q -> \G |- (p & q)
|And_L_1: forall \G p q r, (p & q)\in\G -> p::(\G\(p&q)) |- r -> \G |- r
|And_L_2: forall \G p q r, (p & q)\in\G -> q::(\G\(p&q)) |- r -> \G |- r
|Oplus_L: forall\Gpqr, (p ++ q)\in\G -> p::(\G\(p ++ q))|-r -> q::(\G\(p ++ q))|-r -> \G|-r
|Oplus_R_1: forall \G p q, \G |- p -> \G |- p ++ q
|Oplus_R_2: forall \G p q, \G |- q -> \G |- p ++ q 
|T_: forall \G, \G |- \Top
|Zero_: forall \G p, 0\in\G -> \G |- p
|Bang_D: forall \G p q, !p\in\G -> p::(\G\(!p)) |- q -> \G |- q
|Bang_C: forall \G p q, !p\in\G -> !p::\G |- q -> \G |- q
|Bang_W: forall \G p q, !p\in\G -> \G\(!p) |- q -> \G |- q
where " x |- y ":= (ILL_proof x y).
\end{lstlisting}


Notice the use of the form ``$\phi\in\Gamma \to \Gamma\vdash\dots$''
instead of ``$\phi,\Gamma\vdash\dots$''. This formulation avoids
tedious manipulations on the environment to match rules. Simple
tactics allow to apply rules and premisses of the form $\phi\in\Gamma$
are discharged automatically (on closed environments) by reduction.
Notice also that we do not provide the Cut rule as it is not necessary
to our purpose\marginote{justif? Yep, classique: dans une interpretation preuve/programme, on veut une trace de l'execution, donc on elimine les coupures}.
\emph{As we are looking for a trace of the execution of the narrative actions through the application of the $\multimap$ left rule, we are only searching for cut-free proofs and thus do not provide the Cut rule}.
%quelques details techniques. Comparer avec encodings existants si necessaire (y'en a peu, mais certains pour Isabelle sont plus aboutis avec tactiques). Le truc est simple, expliquer pourquoi.
%\subsection{Specifying Interactive Narratives}
%methode/cuisine pour ecrire le sequent. Faut que ca paraisse facile, et suive naturellement la description de la theorie representationnelle.
\subsection{Proving an ILL Sequent in Coq as narrative generation}
\label{sec:proving-an-ill}
%
Our encoding of ILL into Coq can simply be used with the aim of generating a \emph{well-formed} story, from a sequent specification. We provide a set of simple tactics assisting the user in unfolding a proof, thus constructing a proof-term which will subsequently be interpreted as a narrative.
%Bien dire que si pour l'instant on ne fait que de la verif, il est possible de definir des tactiques efficaces (e.g full auto), meme pour ILL. Ca na pas ete tres recherche mais Dixon a certains resultats preliminaires. Un objectif futur est de travailler sur des tactiques, y compris ad-hoc et correspondant a des usage patterns (voir ce qui a ete fait en computational linguistics avec succes), et qu'il n'est pas completement sans espoir de penser a une tactique "trivial" future (full-automation) meme si c'est un vrai probleme car full ILL est indecidable. Des arguments places ici doivent etre retires de l'etat de l'art et vice-versa, voir ce qui rend le mieux.
%Preuve en tant qu'objet de l'etude et non pas prouvabilite d'un sequent seulement.
%
%\textbf{Cas d'utilisation: une preuve du sequent qui suit l'ordre du roman, preuve assistee meme si pas full-auto}
As an example, let us consider the sequent given below presented earlier on figure~\ref{fig:example}, corresponding to the end of Emma Bovary. \marginote{pb de fontes sur le lollipop}
\begin{lstlisting}[language=Coq]
Goal Emma: {P&1, R, G, B&1, !(S-oA), (E-oA)&1, (P-oM)&1,
(*@\hfill@*)   (R-o1)&(R-oE), (G-o1) ++ (G-oS), 1++(B-oS)&(B-o1)} |- A ++ M.
\end{lstlisting}
We developed a small set of simple tactics helping to apply rules. For
example one can apply the $\oplus_R$ rule on this goal to consider the
alternative offered by external choice \lstinline|(G-o1) ++ (G-oS)|.
This is achieved by tactic: \lstinline|oplus_l (G-o1) (G-oS)|. The
first of the two subgoals is of the form:
\lstinline!{G-o1, P&1, R, G, ... } |- A ++ M!. which allows for rule
$\multimap_l$ rule to perform a narrative action which ``uses''
\lstinline|G| using tactic: \lstinline|impl_l G 1|. \marginote{more
  automation? peut etre juste plus de clarte pour faire style on a une methode? Par exemple, peut on s'en sortir en n'appliquant les tactiques que sur des actions (composees). Et montrer le proof-term obtenu?}

To illustrate the impossibility of building narratives which are not \emph{well-formed}, let us discuss this example of a choice during the proof search, which leads to an unprovable sequent.

Let us suppose we start the proof of \texttt{Emma}
by applying the $\&_{l2}$ rule to the formula \lstinline!(R-o1)&(R-oE)!.

Were the proof to conclude, this would be interpreted by a corresponding narrative necessarily unfolding the narrative action modelled by $R\multimap E$: following their discussion, Rodolphe agrees to run away with Emma.

However, the sequent specifies a branching choice in an open world assumption for any generated narrative, which needs to provide the adequate execution environment for both of the narrative actions specified by $G \multimap 1$ and $G \multimap S$.

Any corresponding proof-search will thus present a branch where the formula $G \multimap S$ will be consumed. Such a proof-search branch would thus comprise an attempt to consume $S$,creating an $A$, and to consume $E$,creating an $A$ as well, while only one A can be eliminated from the environment. It is thus impossible to conclude a proof-search where both formulae $R\multimap E$ and $G\multimap S$ are decomposed in the same branch.

From the narrative perspective, this means that if, in an open-world assumption, an external event can decide that Emma accepts Guillaumin's proposal in order to get out of trouble, it will be impossible to form a narrative unfolding a narrative action providing a redundant way out (for instance escaping with Rodolphe) for this choice.

In Coq, let us suppose we apply rules as follows:
\begin{lstlisting}
Goal Emma: ... .
  and_l_2 (R-o1) (R-oE).
  oplus_l (G -o 1) (G -o S).
\end{lstlisting}
we see that in the third branch we obtain the sequent:
\begin{lstlisting}
{G,G -o S,R, R -o E, !(S -o A), (E -o A) & 1, ...} |- A ++ M
\end{lstlisting}
which forces the choices allowing to ``use'' \texttt{G} and \texttt{S}
(\lstinline!impl_l!):
\begin{lstlisting}
{S,E, !(S -o A), (E -o A) & 1, ...} |- A ++ M
\end{lstlisting}
which will lead to having two \texttt{A} in the environment, which
makes this proof, which would correspond to an incoherent narrative, impossible to conclude.
%DONE PAS COMPLETEMENT
%Exemple de la preuve deroulee, de maniere assistee: une instance d'un
%sequent assez generatif. On montre comment on a produit la preuve en
%Coq, et on raconte l'histoire correspondante, avec les choix possibles
%de l'utilisateur.
%Il faut que ca fasse "methode". Ideal, un truc du genre: l'utilisateur
%choisit une action narrative a executer, et une tactique Coq deroule
%la suite, jusqu'a ce qu'il y aie une nouvelle formule a decomposer. Le
%contexte est coupe en 2 en fait: il y a les formules qui correspondent
%a des actions narratives ou composition d'actions narratives, et des
%trucs qui sont "juste" des ressources ou des etats consommes par les
%actions. L'utilisateur ne travaille que sur les premieres et Coq
%l'aide pour les "details".
%Proposition Pierre: On consomme les $\multimap$, eventuellement en
%utilisant les bangs et les $\otimes$ tant qu'on peut, puis quand on
%peut plus rien consommer on attend que l'utilisateur casse un \&
%(interne) ou un $\oplus$ (externe).
%Considerations sur les possibles alternatives par rapport a la
%structure de la specification, pour lier avec la suite: les "choix
%internes" a la recherche de preuve, l'ordre d'execution des actions.
% DONE:
%Montrer qu'on ne peut pas construire d'histoires qui sont mal formees
%du point de vue des ressources disponibles (e.g. dans notre cas,
%commencer par aller voir Rodolphe et choisir de s'enfuir, donner
%l'intuition de la raison, liee a une competition pour les
%ressources).
\subsection{Second order analysis of interactive narratives specification}
\label{sec:second-order-analys}
%
We have previously described how, based on our interpretation of proof as narratives, a proof assistant allows to build coherent narratives from initial specifications. This naturally leads to wonder, given an initial specification,  what are the characteristics of a \emph{well-formed} story, and thus to study emerging structural properties traversing all the possible narratives a sequent specification can generate. For doing so, we need to be able to express and prove properties by reasoning about proofs and sets of proofs. 

As a proof assistant based on the Curry-Howard isomorphism, Coq is a tool of choice for studying such properties, as it allows to consider proofs as first class objects.
%We make use of the advantage of a proof assistant based on
%Curry-Howard isomorphism by considering proofs (i.e. narratives) as
%object that one can compute and prove on\marginote{english? proofs as first order objects?}. 

For instance, a property which is often important to check regarding a narrative specification concerns the reachability of a given ending state regardless of external events impacts in an open-world assumption.


regarding narratives One important property of a narrative is that there exists at
least one of the possible stories (i.e. branch) that leads to a
particular event (for instance: Emma survives). We make use of the
\texttt{Program Fixpoint} feature of Coq to build a dependently typed
function checking this property for a closed proof. that is that at
least one branch ends with sequent \lstinline!{A} |- A!:
\begin{lstlisting}
Program Fixpoint check \phil \phir {e} {f} (h: e |- f) {struct h}: boolP := 
match h with
 | One_R _ _ => falseP
 | One_L \G p _ x => check \phil \phir x
 | Oplus_R_1 \G p q x =>
    if andP (p ?= \phil) (q ?= \phir) then trueP else check \phil \phir x
 | ...
end.
Eval vm_compute in check A M Emma. (* true*)
\end{lstlisting}

An even more interesting property is that \texttt{check} should return
\texttt{true} for \emph{any proof of} \texttt{Emma} and not only for
the proof we built. This is much more difficult to prove in coq as
there is an infinite set of such proofs. We deal with this problem in
different ways. First we define a notion of equivalence between proofs
if they correspond to the same tree and second we restrict to proofs
of sequent that belong to the grammar described in
figure~\ref{fig:sequent_grammars}. We shall described these two
development in the following.

\subsubsection{Identify proofs corresponding too the same tree}
\label{sec:identif-same-tree}

We identify proofs that differ only by the way side premisses (like
\lstinline!p \in \G! or \lstinline!\G \in \D\U\E!) are proven. We then
prove that \texttt{check} and other definitions are compatible with
this equivalence.
\begin{lstlisting}
Inductive eq: forall \G \G' f, (\G |- f) -> (\G' |- f) -> Prop := 
| EQId: forall \G1 \G2, forall f, forall heq heq', eq (Id \G1 f heq) (Id \G2 f heq')
| EQImpl_R: forall \G1 \G2 p q h h',  eq h h' -> eq (Impl_R \G1 p q h) (Impl_R \G2 p q h')
| EQTimes_R: forall \G1 \D1 \D1' \G2 \D2 \D2' p q heq heq' h1 h1' h2 h2',
  eq h1 h1' -> eq h2 h2' -> eq (Times_R \G1 \D1 \D1' p q heq h1 h2)
(Times_R \G2 \D2 \D2' p q heq' h1' h2')
| ...

Lemma eq_compat_check : forall f1 f2 \G \G' \phi (h1:\G|-\phi) (h2:\G'|-\phi),  Proof_eq.eq h1 h2 -> 
  check (fun _ _ _ => trueP) f1 f2 h1 = check (fun _ _ _ => trueP) f1 f2 h2.
\end{lstlisting}




% Exemple de proprietes-meta, de type "toute histoire generee par
% cette specification de ressources, conditions initiales, et actions
% narratives, verifie telle propriete":\\ preuves sur l'accessibilite
% d'une fin donnee quelque soit la preuve.


% Decrire la preuve de Julien: quelque soit la preuve du sequent, on
% aura toujours une branche qui correspondra a l'application de la
% regle $\oplus$ droite avec la formule $A$ == on aura toujours une
% facon de derouler l'histoire qui menera a l'etat final modelise par
% $A$.


% - preuve qu'une action donnee se produira toujours avant une autre,
% meme sans rapports de precedence/causalite directement encode dans
% le sequent. Dans l'exemple, a cause d'une configuration particuliere
% de competition pour la consommation de ressources narratives
% provoquee par une "interaction" possible. \textbf{Cela met dans cet
%   exemple en evidence une relation structurelle de la specification,
%   qui emerge de l'analyse, et qui est a priori non evidente: elle
%   n'est pas encodee directement dans les specifications.}
% \textbf{Cas d'utilisation 4: exhiber une instance particuliere de
%   narration interactive, qui verifie une propriete structurelle
%   donnee} Avec l'exemple: exhiber une histoire interactive ayant
% plusieurs fins possibles suivant le "chemin" parcouru par
% l'utilisateur. ajout, au second ordre, de contraintes sur la
% recherche de preuve. Permet de resoudre des problemes non traites?
% Lorsque tactiques pour automatiser seront definies, cela permettra
% de rechercher/generer des histoires verifiant certaines proprietes
% structurelles: presence de fins alternatives etc.

\subsubsection{Restricting to well-formed sequents}
\label{sec:restrict}

Some expected properties of proofs are difficult to define for all
proofs of a sequent but may be easier on well-formed proofs.\marginote{Toutes les preuves sont well formed non? Tu veux dire Sequent peut etre?} In order
to use this fact we provide a proof of stability of $\wf$ for ILL
(property~\ref{def:stab}). To this end, we prove the stability of
$\wf$ for each rule as follows: first the grammar of
figure~\ref{fig:sequent_grammars} is defined by the follwing (mutual)
inductive properties:
\begin{lstlisting}
Inductive Act : formula -> Prop := (* Act *)
| A1: Act 1
| A2:forall \phi1 \phi2, Cres \phi1 -> Context \phi2 -> Act (\phi1 -o \phi2)
| A3: forall \phi1 \phi2, Act \phi1 -> Act \phi2 -> Act (\phi1 ++ \phi2)
| A4: forall \phi1 \phi2, Act \phi1 -> Act \phi2 -> Act (\phi1 & \phi2)
| A5: forall \phi, Act \phi -> Act (!\phi)
with Cres: formula -> Prop:= (* CRes *)
| Cres1: Cres 1
| Cres2: forall n, Cres (Proposition n)
| Cres3: forall \phi1 \phi2, Cres \phi1 -> Cres \phi2 -> Cres (\phi1 ** \phi2)
with Context: formula -> Prop:= (* Context *)
| Context1:forall \phi, Act \phi -> Context \phi
| Context2:forall \phi, Res \phi -> Context \phi
| Context3: forall \phi1 \phi2, Context \phi1 -> Context \phi2 -> Context (\phi1 ** \phi2)
with Res: formula -> Prop:= (* Res *)
  R1: Res 1
| R2: forall n, Res (Proposition n)
| R3: forall \phi, Res \phi -> Res (!\phi)
| R4: forall \phi1 \phi2, Res \phi1 -> Res \phi2 -> Res (\phi1 ** \phi2)
| R5: forall \phi1 \phi2, Res \phi1 -> Res \phi2 -> Res (\phi1 & \phi2).

Inductive Goal : formula -> Prop :=
| G1: Goal 1
| G2: forall n, Goal (Proposition n)
| G3: forall \phi1 \phi2, Goal \phi1 -> Goal \phi2 -> Goal (\phi1 ** \phi2)
| G4: forall \phi1 \phi2, Goal \phi1 -> Goal \phi2 -> Goal (\phi1 ++ \phi2)
| G5: forall \phi1 \phi2, Goal \phi1 -> Goal \phi2 -> Goal (\phi1 & \phi2).

Definition Contextall \G f (_:\G|-f):= Goal f/\forall g:formula, g\in\G -> Context g.
\end{lstlisting}
then the stability for each rule is given by an inductive property
\texttt{Istable} mirroring the type of proofs, stating that a property
\texttt{pred} holds for all premisses sequents of all rules.
\begin{lstlisting}
(** This property is true when pred holds for all nodes above the root
   of h (it has not to hold for the root itself). *)
Inductive Istable: forall {e} {f} (h: e |- f) , Prop := 
| IId: forall \G p heq, Istable (Id \G p heq)
| IImpl_R: forall \G p q h, pred h -> Istable h -> Istable (Impl_R \G p q h)
| IImpl_L: forall \G \D \E p q r hin heq h h', pred h -> pred h'
(*@\hfill@*) -> Istable h -> Istable h' -> Istable (Impl_L \G \D \E p q r hin heq h h')
(*@
%| ITimes_R: forall \G \D \E p q heq h h', pred h -> pred h' -> Istable h -> Istable h' -> Istable (Times_R \G \D \E p q heq h h')
% | ITimes_L: forall \G p q r hin h, pred h -> Istable h -> Istable (Times_L \G p q r hin h)
% | IOne_R: forall \G heq, Istable (One_R \G heq)
% | IOne_L: forall \G p hin h, pred h -> Istable h -> Istable (One_L \G p hin h)
% | IAnd_R: forall \G p q h h', pred h -> pred h' -> Istable h -> Istable h' -> Istable (And_R  \G p q h h')
% | IAnd_L_2: forall \G p q r hin h, pred h -> Istable h -> Istable (And_L_2 \G p q r hin h)
% | IAnd_L_1: forall \G p q r hin h, pred h -> Istable h -> Istable (And_L_1 \G p q r hin h)
% | IOplus_L: forall \G p q r hin h h', pred h -> pred h' -> Istable h -> Istable h' -> Istable (Oplus_L  \G p q r hin h h')
% | IOplus_R_2: forall \G p q h, Istable h  -> Istable (Oplus_R_2 \G p q h)
% | IOplus_R_1: forall \G p q h, pred h -> Istable h -> Istable (Oplus_R_1 \G p q h)
% | IT_ : forall \G,  (Istable (T_ \G)) -> (Istable (T_ \G))
% | IZero_: forall \G p truein, (Istable (Zero_ \G p truein)) -> (Istable (Zero_ \G p truein))
% | IBang_D: forall \G p q hin h, pred h -> Istable h -> (Istable (Bang_D \G p q hin h))
% | IBang_C: forall \G p q hin h, pred h -> Istable h -> (Istable (Bang_C \G p q hin h))
% | IBang_W: forall \G p q hin h, pred h -> Istable h -> (Istable
% (Bang_W \G p q hin h)).
%@*)
| ...
\end{lstlisting}
and then the stability of the grammar is then stated as the following lemma:
\begin{lstlisting}
Lemma Grammar_Stable : forall \G \phi (h:\G |- \phi), Contextall h -> Istable Contextall h.
\end{lstlisting}
It is proved by induction on \texttt{h}.


\section{Conclusion}
On a montre que: un couplage ILL et Proof assistant fourni un outil puissant pour etudier les proprietes structurelles de narrations interactives.\\
On a fourni: une methode d'encodage narration vers sequent ILL, une methode pour prouver ce sequent en Coq, un algorithme d'interpretation d'une telle preuve en une narration interactive.\\
Et surtout: reposant sur les morphismes precedemment definis, une methode permettant de prouver des proprietes structurelles au second ordre sur un ensemble de narrations definies a partir des memes conditions initiales, qui repose sur les facilites offertes par Coq de raisonner sur les preuves en tant qu'objets.

Future work: travail sur la normalisation de preuve. vers la definition de classes de preuves/histoires, vers l'analyse de concurrence au sein de la narration. Target: definition/mesures de variance sur des bases structurelles et formelles.
%TPHOLs99) Working with Linear Logic in Coq
%
\bibliography{ITP2011_Coq_Emma}
\bibliographystyle{plain}

\end{document}



%%% Local Variables: 
%%% mode: latex
%%% TeX-PDF-mode: t
%%% ispell-local-dictionary: "british"
%%% TeX-master: t
%%% End: 

% LocalWords:  sequent Coq multisets Guillaumin Rodolphe